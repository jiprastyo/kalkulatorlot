<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Kalkulator Lot</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.57.0/build/stlite.css" />
    <style>
      /* CSS untuk menyembunyikan panah up/down di dalam kotak input */
      /* Tombol +/- di samping kotak akan tetap ada untuk fraksi */
      input[type=number]::-webkit-inner-spin-button, 
      input[type=number]::-webkit-outer-spin-button { 
        -webkit-appearance: none; 
        margin: 0; 
      }
      input[type=number] {
        -moz-appearance: textfield;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script src="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.57.0/build/stlite.js"></script>
    <script>
      stlite.mount(
        {
          requirements: [], // Kosongkan requirements agar ringan & cepat
          entrypoint: "app.py",
          files: {
            "app.py": `
import streamlit as st

# --- Konfigurasi Halaman ---
st.set_page_config(page_title="Kalkulator Lot", layout="centered")

# --- Fungsi Simpan Setting ---
def save_settings(equity, risk):
    st.session_state['saved_equity'] = equity
    st.session_state['saved_risk'] = risk

# --- Inisialisasi State (Memori Sementara) ---
if 'saved_equity' not in st.session_state:
    st.session_state['saved_equity'] = 10000000.0 # Default 10 Juta
if 'saved_risk' not in st.session_state:
    st.session_state['saved_risk'] = 1.0 # Default 1%

# --- Judul ---
st.title("Kalkulator Lot")

# --- Bagian 1: Pengaturan Modal & Risiko ---
with st.container():
    col1, col2 = st.columns(2)
    
    with col1:
        equity = st.number_input("Total Modal (IDR)", 
                                 value=float(st.session_state['saved_equity']), 
                                 step=100000.0, 
                                 format="%.0f")
    
    with col2:
        risk_pct = st.number_input("Risk per Trade (%)", 
                                   value=float(st.session_state['saved_risk']), 
                                   step=0.1, 
                                   format="%.1f")
        
    # Tombol Simpan
    if st.button("ðŸ’¾ Simpan Modal & Risiko"):
        save_settings(equity, risk_pct)
        st.toast("Pengaturan tersimpan untuk sesi ini!", icon="âœ…")

st.divider()

# --- Bagian 2: Input Transaksi (Entry & SL) ---
col_a, col_b = st.columns(2)
with col_a:
    # step=1 membuat tombol +/- berfungsi untuk kenaikan 1 poin
    price = st.number_input("Harga Beli (Entry)", value=1000, step=1)
with col_b:
    stop_loss_price = st.number_input("Harga Stop Loss", value=950, step=1)

# --- Bagian 3: Logika Perhitungan ---
risk_amount = equity * (risk_pct / 100)
risk_per_share = price - stop_loss_price

# Mencegah error pembagian nol atau minus
if risk_per_share > 0:
    total_shares = risk_amount / risk_per_share
    total_lots = int(total_shares / 100)
    total_investment = total_lots * 100 * price
    
    # --- Tampilan Hasil ---
    st.subheader("Hasil Perhitungan")
    
    c1, c2, c3 = st.columns(3)
    c1.metric("Max Risk (Rp)", f"{risk_amount:,.0f}")
    c2.metric("Jumlah Lot", f"{total_lots}")
    c3.metric("Total Modal Terpakai", f"Rp {total_investment:,.0f}")
    
    # Info tambahan jika mau
    st.caption(f"Risk per share: {risk_per_share} poin")

elif risk_per_share <= 0:
    st.error("âš ï¸ Harga Stop Loss harus lebih kecil dari Harga Beli.")
            `,
          },
        },
        document.getElementById("root")
      );
    </script>
  </body>
</html>

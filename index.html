<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Lot</title>
    <style>
        * { font-size: 14px; font-family: sans-serif; box-sizing: border-box; }
        body { background-color: #121212; color: #e0e0e0; padding: 20px; line-height: 1.5; }
        .container { max-width: 480px; margin: auto; background: #1e1e1e; padding: 20px; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; background: #252525; }
        th { background: #333; color: #66bb6a; padding: 10px; text-align: left; border: 1px solid #444; }
        td { padding: 8px 10px; border: 1px solid #444; }
        input { width: 100%; padding: 8px; background: #2d2d2d; color: white; border: 1px solid #444; border-radius: 4px; }
        .muted-green { color: #81c784; }
        .muted-red { color: #e57373; }
        button { width: 100%; padding: 12px; background: #457b47; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; margin-bottom: 20px;}
        button:hover { background: #38633a; }
        .result-box { background: #252525; padding: 15px; border-top: 2px solid #457b47; border-radius: 4px; }
        .status-tag { font-weight: bold; }
        .tp-table { width: 100%; margin-top: 15px; }
        .tp-table td { border: 1px solid #444; padding: 8px; vertical-align: middle; }
        .warning-text { font-size: 12px; color: #ffa726; font-style: italic; margin-top: 10px; display: block; }
    </style>
</head>
<body>

<div class="container">
    <h3 style="text-align: center; margin-top: 0; color: white; font-size: 16px;">Kalkulator Lot</h3>
    
    <table>
        <thead><tr><th colspan="2">PENGATURAN MODAL & RISIKO</th></tr></thead>
        <tbody>
            <tr><td width="50%">Modal (Rp)</td><td><input type="text" id="modalDisplay" placeholder="Contoh: 50.000.000" oninput="formatModal(this); saveSettings();"></td></tr>
            <tr><td>Risiko Per Trade (%)</td><td><input type="number" id="riskPct" step="0.01" placeholder="0.50" oninput="saveSettings();"></td></tr>
            <tr><td>Est. Risiko (Rp)</td><td id="nominalRiskDisplay" class="muted-red">Rp 0</td></tr>
        </tbody>
    </table>

    <table>
        <thead><tr><th colspan="2">RENCANA ENTRI</th></tr></thead>
        <tbody>
            <tr><td width="50%">Ticker Saham</td><td><input type="text" id="ticker" placeholder="ketik kode saham" oninput="checkTicker()"></td></tr>
            <tr><td>Harga Entri</td><td><input type="number" id="entry" value="0" oninput="updateStep(this)"></td></tr>
            <tr><td>Harga Stop Loss</td><td><input type="number" id="sl" value="0" oninput="updateStep(this)"></td></tr>
        </tbody>
    </table>

    <button onclick="calculate()">HITUNG TRANSAKSI</button>

    <div id="results" class="result-box" style="display:none;">
        <table>
            <thead><tr><th colspan="2">HASIL PENGHITUNGAN</th></tr></thead>
            <tbody>
                <tr><td width="50%">Ticker</td><td><span id="resTicker" style="font-weight:bold; text-transform:uppercase;">-</span> <span id="resSharia"></span></td></tr>
                <tr><td>Harga Entri</td><td id="infoEntry"></td></tr>
                <tr><td>Lot Beli</td><td><strong id="resLot" class="muted-green">0</strong> Lot</td></tr>
                <tr><td>Harga Stop Loss</td><td id="infoSL"></td></tr>
                <tr><td>Persen SL</td><td id="infoRiskPct" class="muted-red"></td></tr>
                <tr><td>Nilai Transaksi</td><td id="resValue"></td></tr>
                <tr><td>Risiko Uang (1R)</td><td id="resRisk" class="muted-red"></td></tr>
            </tbody>
        </table>

        <span class="warning-text">*Peringatan: Belum termasuk fee jual beli sekuritas.</span>
        
        <div style="font-weight: bold; margin-top: 15px; margin-bottom: 5px;">TABEL REWARD</div>
        <table class="tp-table">
            <thead>
                <tr style="background:#333;">
                    <td style="color:#81c784;">Label & Profit (%)</td>
                    <td>Target Harga & Estimasi (Rp)</td>
                </tr>
            </thead>
            <tbody id="tpBody"></tbody>
        </table>
    </div>
</div>

<script>
function saveSettings() {
    const modal = document.getElementById('modalDisplay').value;
    const risk = document.getElementById('riskPct').value;
    localStorage.setItem('userModal', modal);
    localStorage.setItem('userRisk', risk);
    updateNominalRisk();
}

function loadSettings() {
    const savedModal = localStorage.getItem('userModal');
    const savedRisk = localStorage.getItem('userRisk');
    if (savedModal) document.getElementById('modalDisplay').value = savedModal;
    else document.getElementById('modalDisplay').value = "50.000.000";
    if (savedRisk) document.getElementById('riskPct').value = savedRisk;
    else document.getElementById('riskPct').value = "0.50";
    updateNominalRisk();
}

function getIHSGStep(p) {
    if (p < 200) return 1; if (p < 500) return 2; if (p < 2000) return 5; if (p < 5000) return 10; return 25;
}

function updateStep(input) { input.step = getIHSGStep(parseFloat(input.value)); }

function formatModal(input) {
    let v = input.value.replace(/\D/g, "");
    input.value = v.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

function updateNominalRisk() {
    const m = parseFloat(document.getElementById('modalDisplay').value.replace(/\./g, "")) || 0;
    const r = parseFloat(document.getElementById('riskPct').value) || 0;
    document.getElementById('nominalRiskDisplay').innerText = "Rp " + Math.floor(m * (r / 100)).toLocaleString('id-ID');
}

const shariaStocks = ["AADI", "AALI", "ABMM", "ACES", "ACST", "ADCP", "ADES", "ADHI", "ADMG", "ADMR", "ADRO", "AGAR", "AGII", "AIMS", "AISA", "AKKU", "AKPI", "AKRA", "AKSI", "ALDO", "ALKA", "AMAN", "AMFG", "AMIN", "ANDI", "ANJT", "ANTM", "APII", "APLI", "APLN", "ARCI", "AREA", "ARGO", "ARII", "ARNA", "ARTA", "ASGR", "ASHA", "ASII", "ASLC", "ASLI", "ASPI", "ASRI", "ASSA", "ATAP", "ATIC", "ATLA", "AUTO", "AVIA", "AWAN", "AXIO", "AYAM", "AYLS", "BABY", "BAIK", "BANK", "BAPI", "BATA", "BATR", "BAUT", "BAYU", "BBRM", "BBSS", "BCIP", "BDKR", "BEEF", "BELI", "BELL", "BESS", "BEST", "BIKE", "BINO", "BIPP", "BIRD", "BISI", "BKDP", "BKSL", "BLES", "BLOG", "BLTA", "BLTZ", "BLUE", "BMHS", "BMSR", "BMTR", "BNBR", "BOAT", "BOBA", "BOGA", "BOLA", "BOLT", "BRAM", "BRIS", "BRMS", "BRNA", "BRPT", "BRRC", "BSBK", "BSDE", "BSML", "BSSR", "BTPS", "BUAH", "BUKK", "BULL", "BUMI", "BUVA", "BYAN", "CAKK", "CAMP", "CANI", "CARE", "CASS", "CBDK", "CBPE", "CBRE", "CCSI", "CEKA", "CGAS", "CHEK", "CHEM", "CINT", "CITA", "CITY", "CLEO", "CLPI", "CMNP", "CMPP", "CMRY", "CNKO", "CNMA", "COAL", "CPIN", "CPRO", "CRAB", "CRSN", "CSAP", "CSIS", "CSMI", "CSRA", "CTBN", "CTRA", "CYBR", "DAAZ", "DADA", "DATA", "DAYA", "DCII", "DEFI", "DEPO", "DEWA", "DEWI", "DGIK", "DGNS", "DGWG", "DILD", "DIVA", "DKFT", "DKHH", "DMAS", "DMMX", "DMND", "DOOH", "DOSS", "DRMA", "DSFI", "DSNG", "DSSA", "DUTI", "DVLA", "DWGL", "DYAN", "EAST", "ECII", "EDGE", "EKAD", "ELIT", "ELPI", "ELSA", "ELTY", "EMDE", "ENAK", "ENRG", "EPAC", "EPMT", "ERAA", "ERAL", "ESIP", "ESSA", "ESTA", "EXCL", "FAST", "FASW", "FILM", "FIRE", "FISH", "FITT", "FMII", "FOLK", "FOOD", "FORE", "FPNI", "FUTR", "FWCT", "GDST", "GDYR", "GEMA", "GEMS", "GGRP", "GHON", "GIAA", "GJTL", "GLVA", "GMTD", "GOLD", "GOLF", "GOOD", "GPRA", "GPSO", "GRIA", "GRPH", "GTBO", "GTRA", "GTSI", "GULA", "GUNA", "GWSA", "GZCO", "HADE", "HAIS", "HALO", "HATM", "HDIT", "HEAL", "HERO", "HEXA", "HGII", "HITS", "HOKI", "HOMI", "HOPE", "HRME", "HRUM", "HUMI", "HYGN", "IATA", "IBST", "ICBP", "ICON", "IDPR", "IFII", "IFSH", "IGAR", "IIKP", "IKAI", "IKAN", "IKBI", "IKPM", "IMPC", "INCI", "INCO", "INDF", "INDR", "INDS", "INDX", "INDY", "INET", "INKP", "INPP", "INTD", "INTP", "IOTF", "IPCC", "IPCM", "IPOL", "IPTV", "IRRA", "IRSX", "ISAT", "ISSP", "ITMA", "ITMG", "JAST", "JATI", "JAWA", "JAYA", "JECC", "JGLE", "JIHD", "JKON", "JMAS", "JPFA", "JRPT", "JSMR", "JSPT", "JTPE", "KAQI", "KARW", "KBAG", "KBLI", "KBLM", "KDSI", "KDTN", "KEEN", "KEJU", "KETR", "KIAS", "KICI", "KIJA", "KINO", "KIOS", "KJEN", "KKES", "KKGI", "KLAS", "KLBF", "KMDS", "KOBX", "KOCI", "KOIN", "KOKA", "KONI", "KOPI", "KOTA", "KPIG", "KREN", "KRYA", "KSIX", "KUAS", "LABA", "LABS", "LAJU", "LAND", "LCKM", "LION", "LIVE", "LMPI", "LMSH", "LPCK", "LPIN", "LPKR", "LPLI", "LPPF", "LRNA", "LSIP", "LTLS", "LUCK", "MAHA", "MAIN", "MAPA", "MAPB", "MAPI", "MARK", "MAXI", "MBAP", "MBMA", "MBTO", "MCAS", "MCOL", "MDIY", "MDKA", "MDKI", "MDLA", "MEDC", "MEDS", "MERI", "MERK", "META", "MFMI", "MGNA", "MHKI", "MICE", "MIDI", "MIKA", "MINA", "MINE", "MIRA", "MITI", "MKAP", "MKPI", "MKTR", "MLIA", "MLPL", "MLPT", "MMIX", "MMLP", "MNCN", "MORA", "MPIX", "MPMX", "MPOW", "MPPA", "MPRO", "MRAT", "MSIN", "MSJA", "MSKY", "MSTI", "MTDL", "MTEL", "MTFN", "MTLA", "MTMH", "MTPS", "MTSM", "MUTU", "MYOH", "MYOR", "NAIK", "NASA", "NASI", "NCKL", "NELY", "NEST", "NETV", "NFCX", "NICE", "NICL", "NIKL", "NPGF", "NRCA", "NTBK", "NZIA", "OASA", "OBAT", "OBMD", "OILS", "OKAS", "OMED", "OMRE", "PADA", "PALM", "PAMG", "PANI", "PANR", "PART", "PBID", "PBSA", "PCAR", "PDES", "PDPP", "PEHA", "PEVE", "PGAS", "PGEO", "PGLI", "PGUN", "PICO", "PIPA", "PJAA", "PJHB", "PKPK", "PLIN", "PMJS", "PMUI", "PNBS", "PNGO", "PNSE", "POLI", "POLU", "PORT", "POWR", "PPRE", "PPRI", "PPRO", "PRAY", "PRDA", "PRIM", "PSAB", "PSAT", "PSDN", "PSGO", "PSKT", "PSSI", "PTBA", "PTIS", "PTMP", "PTMR", "PTPP", "PTPS", "PTPW", "PTSN", "PTSP", "PURA", "PURI", "PWON", "PZZA", "RAAM", "RAFI", "RAJA", "RALS", "RANC", "RATU", "RBMS", "RDTX", "RGAS", "RIGS", "RISE", "RMKE", "RMKO", "ROCK", "RODA", "RONY", "ROTI", "RSGK", "RUIS", "SAFE", "SAGE", "SAME", "SAMF", "SAPX", "SATU", "SBMA", "SCCO", "SCNP", "SCPI", "SEMA", "SGER", "SGRO", "SHID", "SHIP", "SICO", "SIDO", "SILO", "SIMP", "SIPD", "SKBM", "SKLT", "SKRN", "SLIS", "SMAR", "SMBR", "SMCB", "SMDM", "SMDR", "SMGA", "SMGR", "SMIL", "SMKL", "SMLE", "SMMT", "SMRA", "SMSM", "SNLK", "SOCI", "SOHO", "SOLA", "SONA", "SOSS", "SOTS", "SPMA", "SPTO", "SRTG", "SSIA", "SSTM", "STAA", "STTP", "SULI", "SUNI", "SUPR", "SURI", "SWID", "TALF", "TAMA", "TAMU", "TAPG", "TARA", "TAXI", "TBMS", "TCID", "TCPI", "TEBE", "TFAS", "TFCO", "TGKA", "TGUK", "TINS", "TIRA", "TIRT", "TKIM", "TLDN", "TLKM", "TMAS", "TMPO", "TNCA", "TOBA", "TOOL", "TOSK", "TOTL", "TOTO", "TPIA", "TPMA", "TRIS", "TRJA", "TRON", "TRST", "TRUE", "TRUK", "TSPC", "TYRE", "UANG", "UCID", "UFOE", "ULTJ", "UNIC", "UNIQ", "UNTR", "UNVR", "UVCR", "VAST", "VERN", "VICI", "VISI", "VKTR", "VOKS", "WAPO", "WEGE", "WEHA", "WINR", "WINS", "WIRG", "WMUU", "WOOD", "WOWS", "WTON", "YELO", "YPAS", "YUPI", "ZATA", "ZONE", "ZYRX"];

function checkTicker() {
    const t = document.getElementById('ticker').value.toUpperCase();
    const s = document.getElementById('resSharia');
    document.getElementById('resTicker').innerText = t || "-";
    if (!t) { s.innerText = ""; return; }
    if (shariaStocks.includes(t)) { s.innerText = " (✓ Syariah/ISSI)"; s.className = "status-tag muted-green"; }
    else { s.innerText = " (✗ Non-ISSI)"; s.className = "status-tag muted-red"; }
}

function calculate() {
    const m = parseFloat(document.getElementById('modalDisplay').value.replace(/\./g, ""));
    const rp = parseFloat(document.getElementById('riskPct').value) / 100;
    const e = parseFloat(document.getElementById('entry').value);
    const sl = parseFloat(document.getElementById('sl').value);
    if (!m || e <= 0 || sl <= 0) { alert("Data belum lengkap atau harga harus > 0"); return; }
    const rps = e - sl;
    if (rps <= 0) { alert("Harga Stop Loss harus di bawah Harga Entri"); return; }

    const lot = Math.floor((m * rp / rps) / 100);
    const val = lot * 100 * e;

    document.getElementById('infoEntry').innerText = e.toLocaleString('id-ID');
    document.getElementById('infoSL').innerText = sl.toLocaleString('id-ID');
    document.getElementById('infoRiskPct').innerText = ((rps/e)*100).toFixed(2) + "%";
    document.getElementById('resLot').innerText = lot.toLocaleString('id-ID');
    document.getElementById('resValue').innerText = "Rp " + val.toLocaleString('id-ID');
    document.getElementById('resRisk').innerText = "Rp " + (lot * 100 * rps).toLocaleString('id-ID');
    
    let html = "";
    for(let r=1; r<=6; r++) {
        const tp = e + (rps * r);
        const tpp = (((tp-e)/e)*100).toFixed(2);
        const prof = lot * 100 * (rps * r);
        html += `<tr>
            <td width="40%">
                <span style="font-size:12px;color:#bbb;">TP (${r}x Risk)</span><br>
                <span class="muted-green" style="font-weight:bold;">+${tpp}%</span>
            </td>
            <td>
                <strong style="font-size:15px;">${tp.toLocaleString('id-ID')}</strong><br>
                <span style="font-size:11px;color:#aaa;">Profit: Rp ${prof.toLocaleString('id-ID')}</span>
            </td>
        </tr>`;
    }
    document.getElementById('tpBody').innerHTML = html;
    document.getElementById('results').style.display = 'block';
}

document.addEventListener('DOMContentLoaded', () => { 
    loadSettings();
    updateStep(document.getElementById('entry'));
    updateStep(document.getElementById('sl'));
});
</script>
</body>
</html>

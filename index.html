<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Lot</title>
    <style>
        /* Variabel Warna & Tema */
        :root {
            --bg-color: #000000; /* Default AMOLED */
            --container-bg: #121212;
            --table-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #333;
            --accent-blue: #2196f3;
            --accent-header: #1a237e;
            --muted-red: #e57373;
            --muted-blue: #90caf9;
            --input-bg: #2d2d2d;
            --radius: 12px;
        }

        [data-theme="day"] {
            --bg-color: #f5f5f5;
            --container-bg: #ffffff;
            --table-bg: #f9f9f9;
            --text-color: #333333;
            --border-color: #ddd;
            --accent-blue: #1976d2;
            --accent-header: #e3f2fd;
            --muted-red: #d32f2f;
            --muted-blue: #1565c0;
            --input-bg: #ffffff;
        }

        * { font-size: 14px; font-family: sans-serif; box-sizing: border-box; transition: background 0.3s, color 0.3s; }
        
        body { background-color: var(--bg-color); color: var(--text-color); padding: 20px; line-height: 1.5; }
        .container { max-width: 480px; margin: auto; background: var(--container-bg); padding: 20px; border-radius: var(--radius); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        
        /* Tema Switcher */
        .theme-switch { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .theme-btn { padding: 6px 12px; border-radius: 20px; border: 1px solid var(--border-color); cursor: pointer; background: var(--table-bg); color: var(--text-color); }
        .theme-btn.active { background: var(--accent-blue); color: white; border-color: var(--accent-blue); }

        table { width: 100%; border-collapse: separate; border-spacing: 0; margin-bottom: 20px; background: var(--table-bg); border-radius: var(--radius); overflow: hidden; border: 1px solid var(--border-color); }
        th { background: var(--accent-header); color: var(--muted-blue); padding: 12px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid var(--border-color); }
        
        input { width: 100%; padding: 10px; background: var(--input-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 8px; }
        input:focus { outline: none; border-color: var(--accent-blue); }

        .muted-blue { color: var(--muted-blue); }
        .muted-red { color: var(--muted-red); }
        
        button.primary-btn { width: 100%; padding: 14px; background: var(--accent-blue); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 15px; }
        button.copy-btn { width: 100%; padding: 10px; background: transparent; color: var(--accent-blue); border: 1px solid var(--accent-blue); border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 20px; }
        
        .result-box { background: var(--table-bg); padding: 15px; border-top: 3px solid var(--accent-blue); border-radius: var(--radius); margin-top: 10px; }
        .tp-table td { border: 1px solid var(--border-color); }
        .warning-text { font-size: 12px; color: #ffa726; font-style: italic; margin-top: 10px; display: block; }
    </style>
</head>
<body>

<div class="container">
    <div class="theme-switch">
        <div id="btnAmoled" class="theme-btn active" onclick="setTheme('amoled')">AMOLED</div>
        <div id="btnDay" class="theme-btn" onclick="setTheme('day')">Day Mode</div>
    </div>

    <h3 style="text-align: center; margin-top: 0; font-size: 16px;">Kalkulator Lot</h3>
    
    <table>
        <thead><tr><th colspan="2">PENGATURAN MODAL & RISIKO</th></tr></thead>
        <tbody>
            <tr><td width="50%">Modal (Rp)</td><td><input type="text" id="modalDisplay" placeholder="Contoh: 50.000.000" oninput="formatModal(this); saveSettings();"></td></tr>
            <tr><td>Risiko Per Trade (%)</td><td><input type="number" id="riskPct" step="0.1" placeholder="0.50" oninput="updateRiskStep(this); saveSettings();"></td></tr>
            <tr><td>Est. Risiko (Rp)</td><td id="nominalRiskDisplay" class="muted-red">Rp 0</td></tr>
        </tbody>
    </table>

    <table>
        <thead><tr><th colspan="2">RENCANA ENTRI</th></tr></thead>
        <tbody>
            <tr><td width="50%">Ticker Saham</td><td><input type="text" id="ticker" placeholder="ketik kode saham" oninput="checkTicker()"></td></tr>
            <tr><td>Harga Entri</td><td><input type="number" id="entry" value="0" oninput="updatePriceStep(this)"></td></tr>
            <tr><td>Harga Stop Loss</td><td><input type="number" id="sl" value="0" oninput="updatePriceStep(this)"></td></tr>
        </tbody>
    </table>

    <button class="primary-btn" onclick="calculate()">HITUNG TRANSAKSI</button>

    <div id="results" class="result-box" style="display:none;">
        <button class="copy-btn" onclick="copyPlan()">SALIN RENCANA TRADING</button>
        
        <table>
            <thead><tr><th colspan="2">HASIL PENGHITUNGAN</th></tr></thead>
            <tbody id="summaryBody">
                <tr><td width="50%">Ticker</td><td><span id="resTicker" style="font-weight:bold; text-transform:uppercase;">-</span> <span id="resSharia"></span></td></tr>
                <tr><td>Harga Entri</td><td id="infoEntry"></td></tr>
                <tr><td>Lot Beli</td><td><strong id="resLot" class="muted-blue">0</strong> Lot</td></tr>
                <tr><td>Harga Stop Loss</td><td id="infoSL"></td></tr>
                <tr><td>Persen SL</td><td id="infoRiskPct" class="muted-red"></td></tr>
                <tr><td>Nilai Transaksi</td><td id="resValue"></td></tr>
                <tr><td>Risiko Uang (1R)</td><td id="resRisk" class="muted-red"></td></tr>
            </tbody>
        </table>

        <span class="warning-text">*Peringatan: Belum termasuk fee jual beli sekuritas.</span>
        
        <div style="font-weight: bold; margin-top: 15px; margin-bottom: 8px;">TARGET REWARD</div>
        <table class="tp-table"><tbody id="tpBody"></tbody></table>
    </div>
</div>

<script>
// --- LOGIKA TEMA ---
function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    document.getElementById('btnAmoled').classList.toggle('active', theme === 'amoled');
    document.getElementById('btnDay').classList.toggle('active', theme === 'day');
    localStorage.setItem('userTheme', theme);
}

// --- LOGIKA HARGA & RISIKO ---
function updateRiskStep(input) {
    input.step = (parseFloat(input.value) < 1) ? 0.1 : 0.5;
}

function getIHSGStep(p) {
    if (p < 200) return 1; if (p < 500) return 2; if (p < 2000) return 5; if (p < 5000) return 10; return 25;
}

function updatePriceStep(input) { 
    input.step = getIHSGStep(parseFloat(input.value)); 
}

function formatModal(input) {
    let v = input.value.replace(/\D/g, "");
    input.value = v.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

function updateNominalRisk() {
    const m = parseFloat(document.getElementById('modalDisplay').value.replace(/\./g, "")) || 0;
    const r = parseFloat(document.getElementById('riskPct').value) || 0;
    document.getElementById('nominalRiskDisplay').innerText = "Rp " + Math.floor(m * (r / 100)).toLocaleString('id-ID');
}

// --- SALIN KE CLIPBOARD ---
function copyPlan() {
    const ticker = document.getElementById('resTicker').innerText;
    const sharia = document.getElementById('resSharia').innerText;
    const entry = document.getElementById('infoEntry').innerText;
    const lot = document.getElementById('resLot').innerText;
    const sl = document.getElementById('infoSL').innerText;
    const slPct = document.getElementById('infoRiskPct').innerText;
    const riskRp = document.getElementById('resRisk').innerText;

    let text = `TRADING PLAN ${ticker} ${sharia}\n`;
    text += `Entry: ${entry}\nLot: ${lot} Lot\nSL: ${sl} (${slPct})\nRisk: ${riskRp}\n\n`;
    text += `Target Reward:\n`;
    
    // Ambil data TP dari tabel
    const rows = document.querySelectorAll('#tpBody tr');
    rows.forEach(row => {
        const label = row.cells[0].innerText.replace('\n', ' ');
        const price = row.cells[1].innerText.split('\n')[0];
        text += `- ${label}: ${price}\n`;
    });

    navigator.clipboard.writeText(text).then(() => {
        alert("Rencana Trading disalin ke clipboard!");
    });
}

// --- DATA & HITUNG ---
const shariaStocks = ["AADI", "AALI", "ABMM", "ACES", "ACST", "ADCP", "ADES", "ADHI", "ADMG", "ADMR", "ADRO", "AGAR", "AGII", "AIMS", "AISA", "AKKU", "AKPI", "AKRA", "AKSI", "ALDO", "ALKA", "AMAN", "AMFG", "AMIN", "ANDI", "ANJT", "ANTM", "APII", "APLI", "APLN", "ARCI", "AREA", "ARGO", "ARII", "ARNA", "ARTA", "ASGR", "ASHA", "ASII", "ASLC", "ASLI", "ASPI", "ASRI", "ASSA", "ATAP", "ATIC", "ATLA", "AUTO", "AVIA", "AWAN", "AXIO", "AYAM", "AYLS", "BABY", "BAIK", "BANK", "BAPI", "BATA", "BATR", "BAUT", "BAYU", "BBRM", "BBSS", "BCIP", "BDKR", "BEEF", "BELI", "BELL", "BESS", "BEST", "BIKE", "BINO", "BIPP", "BIRD", "BISI", "BKDP", "BKSL", "BLES", "BLOG", "BLTA", "BLTZ", "BLUE", "BMHS", "BMSR", "BMTR", "BNBR", "BOAT", "BOBA", "BOGA", "BOLA", "BOLT", "BRAM", "BRIS", "BRMS", "BRNA", "BRPT", "BRRC", "BSBK", "BSDE", "BSML", "BSSR", "BTPS", "BUAH", "BUKK", "BULL", "BUMI", "BUVA", "BYAN", "CAKK", "CAMP", "CANI", "CARE", "CASS", "CBDK", "CBPE", "CBRE", "CCSI", "CEKA", "CGAS", "CHEK", "CHEM", "CINT", "CITA", "CITY", "CLEO", "CLPI", "CMNP", "CMPP", "CMRY", "CNKO", "CNMA", "COAL", "CPIN", "CPRO", "CRAB", "CRSN", "CSAP", "CSIS", "CSMI", "CSRA", "CTBN", "CTRA", "CYBR", "DAAZ", "DADA", "DATA", "DAYA", "DCII", "DEFI", "DEPO", "DEWA", "DEWI", "DGIK", "DGNS", "DGWG", "DILD", "DIVA", "DKFT", "DKHH", "DMAS", "DMMX", "DMND", "DOOH", "DOSS", "DRMA", "DSFI", "DSNG", "DSSA", "DUTI", "DVLA", "DWGL", "DYAN", "EAST", "ECII", "EDGE", "EKAD", "ELIT", "ELPI", "ELSA", "ELTY", "EMDE", "ENAK", "ENRG", "EPAC", "EPMT", "ERAA", "ERAL", "ESIP", "ESSA", "ESTA", "EXCL", "FAST", "FASW", "FILM", "FIRE", "FISH", "FITT", "FMII", "FOLK", "FOOD", "FORE", "FPNI", "FUTR", "FWCT", "GDST", "GDYR", "GEMA", "GEMS", "GGRP", "GHON", "GIAA", "GJTL", "GLVA", "GMTD", "GOLD", "GOLF", "GOOD", "GPRA", "GPSO", "GRIA", "GRPH", "GTBO", "GTRA", "GTSI", "GULA", "GUNA", "GWSA", "GZCO", "HADE", "HAIS", "HALO", "HATM", "HDIT", "HEAL", "HERO", "HEXA", "HGII", "HITS", "HOKI", "HOMI", "HOPE", "HRME", "HRUM", "HUMI", "HYGN", "IATA", "IBST", "ICBP", "ICON", "IDPR", "IFII", "IFSH", "IGAR", "IIKP", "IKAI", "IKAN", "IKBI", "IKPM", "IMPC", "INCI", "INCO", "INDF", "INDR", "INDS", "INDX", "INDY", "INET", "INKP", "INPP", "INTD", "INTP", "IOTF", "IPCC", "IPCM", "IPOL", "IPTV", "IRRA", "IRSX", "ISAT", "ISSP", "ITMA", "ITMG", "JAST", "JATI", "JAWA", "JAYA", "JECC", "JGLE", "JIHD", "JKON", "JMAS", "JPFA", "JRPT", "JSMR", "JSPT", "JTPE", "KAQI", "KARW", "KBAG", "KBLI", "KBLM", "KDSI", "KDTN", "KEEN", "KEJU", "KETR", "KIAS", "KICI", "KIJA", "KINO", "KIOS", "KJEN", "KKES", "KKGI", "KLAS", "KLBF", "KMDS", "KOBX", "KOCI", "KOIN", "KOKA", "KONI", "KOPI", "KOTA", "KPIG", "KREN", "KRYA", "KSIX", "KUAS", "LABA", "LABS", "LAJU", "LAND", "LCKM", "LION", "LIVE", "LMPI", "LMSH", "LPCK", "LPIN", "LPKR", "LPLI", "LPPF", "LRNA", "LSIP", "LTLS", "LUCK", "MAHA", "MAIN", "MAPA", "MAPB", "MAPI", "MARK", "MAXI", "MBAP", "MBMA", "MBTO", "MCAS", "MCOL", "MDIY", "MDKA", "MDKI", "MDLA", "MEDC", "MEDS", "MERI", "MERK", "META", "MFMI", "MGNA", "MHKI", "MICE", "MIDI", "MIKA", "MINA", "MINE", "MIRA", "MITI", "MKAP", "MKPI", "MKTR", "MLIA", "MLPL", "MLPT", "MMIX", "MMLP", "MNCN", "Mora", "MPIX", "MPMX", "MPOW", "MPPA", "MPRO", "MRAT", "MSIN", "MSJA", "MSKY", "MSTI", "MTDL", "MTEL", "MTFN", "MTLA", "MTMH", "MTPS", "MTSM", "MUTU", "MYOH", "MYOR", "NAIK", "NASA", "NASI", "NCKL", "NELY", "NEST", "NETV", "NFCX", "NICE", "NICL", "NIKL", "NPGF", "NRCA", "NTBK", "NZIA", "OASA", "OBAT", "OBMD", "OILS", "OKAS", "OMED", "OMRE", "PADA", "PALM", "PAMG", "PANI", "PANR", "PART", "PBID", "PBSA", "PCAR", "PDES", "PDPP", "PEHA", "PEVE", "PGAS", "PGEO", "PGLI", "PGUN", "PICO", "PIPA", "PJAA", "PJHB", "PKPK", "PLIN", "PMJS", "PMUI", "PNBS", "PNGO", "PNSE", "POLI", "POLU", "PORT", "POWR", "PPRE", "PPRI", "PPRO", "PRAY", "PRDA", "PRIM", "PSAB", "PSAT", "PSDN", "PSGO", "PSKT", "PSSI", "PTBA", "PTIS", "PTMP", "PTMR", "PTPP", "PTPS", "PTPW", "PTSN", "PTSP", "PURA", "PURI", "PWON", "PZZA", "RAAM", "RAFI", "RAJA", "RALS", "RANC", "RATU", "RBMS", "RDTX", "RGAS", "RIGS", "RISE", "RMKE", "RMKO", "ROCK", "RODA", "RONY", "ROTI", "RSGK", "RUIS", "SAFE", "SAGE", "SAME", "SAMF", "SAPX", "SATU", "SBMA", "SCCO", "SCNP", "SCPI", "SEMA", "SGER", "SGRO", "SHID", "SHIP", "SICO", "SIDO", "SILO", "SIMP", "SIPD", "SKBM", "SKLT", "SKRN", "SLIS", "SMAR", "SMBR", "SMCB", "SMDM", "SMDR", "SMGA", "SMGR", "SMIL", "SMKL", "SMLE", "SMMT", "SMRA", "SMSM", "SNLK", "SOCI", "SOHO", "SOLA", "SONA", "SOSS", "SOTS", "SPMA", "SPTO", "SRTG", "SSIA", "SSTM", "STAA", "STTP", "SULI", "SUNI", "SUPR", "SURI", "SWID", "TALF", "TAMA", "TAMU", "TAPG", "TARA", "TAXI", "TBMS", "TCID", "TCPI", "TEBE", "TFAS", "TFCO", "TGKA", "TGUK", "TINS", "TIRA", "TIRT", "TKIM", "TLDN", "TLKM", "TMAS", "TMPO", "TNCA", "TOBA", "TOOL", "TOSK", "TOTL", "TOTO", "TPIA", "TPMA", "TRIS", "TRJA", "TRON", "TRST", "TRUE", "TRUK", "TSPC", "TYRE", "UANG", "UCID", "UFOE", "ULTJ", "UNIC", "UNIQ", "UNTR", "UNVR", "UVCR", "VAST", "VERN", "VICI", "VISI", "VKTR", "VOKS", "WAPO", "WEGE", "WEHA", "WINR", "WINS", "WIRG", "WMUU", "WOOD", "WOWS", "WTON", "YELO", "YPAS", "YUPI", "ZATA", "ZONE", "ZYRX"];

function saveSettings() {
    localStorage.setItem('userModal', document.getElementById('modalDisplay').value);
    localStorage.setItem('userRisk', document.getElementById('riskPct').value);
    updateNominalRisk();
}

function loadSettings() {
    document.getElementById('modalDisplay').value = localStorage.getItem('userModal') || "50.000.000";
    document.getElementById('riskPct').value = localStorage.getItem('userRisk') || "0.50";
    const theme = localStorage.getItem('userTheme') || 'amoled';
    setTheme(theme);
    updateNominalRisk();
}

function checkTicker() {
    const t = document.getElementById('ticker').value.toUpperCase();
    const s = document.getElementById('resSharia');
    document.getElementById('resTicker').innerText = t || "-";
    if (!t) { s.innerText = ""; return; }
    if (shariaStocks.includes(t)) { s.innerText = " (✓ Syariah/ISSI)"; s.className = "status-tag muted-blue"; }
    else { s.innerText = " (✗ Non-ISSI)"; s.className = "status-tag muted-red"; }
}

function calculate() {
    const m = parseFloat(document.getElementById('modalDisplay').value.replace(/\./g, ""));
    const rp = parseFloat(document.getElementById('riskPct').value) / 100;
    const e = parseFloat(document.getElementById('entry').value);
    const sl = parseFloat(document.getElementById('sl').value);
    if (!m || e <= 0 || sl <= 0) { alert("Data belum lengkap"); return; }
    const rps = e - sl;
    if (rps <= 0) { alert("Harga Stop Loss harus di bawah Harga Entri"); return; }

    const lot = Math.floor((m * rp / rps) / 100);
    const val = lot * 100 * e;

    document.getElementById('infoEntry').innerText = e.toLocaleString('id-ID');
    document.getElementById('infoSL').innerText = sl.toLocaleString('id-ID');
    document.getElementById('infoRiskPct').innerText = ((rps/e)*100).toFixed(2) + "%";
    document.getElementById('resLot').innerText = lot.toLocaleString('id-ID');
    document.getElementById('resValue').innerText = "Rp " + val.toLocaleString('id-ID');
    document.getElementById('resRisk').innerText = "Rp " + (lot * 100 * rps).toLocaleString('id-ID');
    
    let html = "";
    for(let r=1; r<=6; r++) {
        const tp = e + (rps * r);
        const tpp = (((tp-e)/e)*100).toFixed(2);
        const prof = lot * 100 * (rps * r);
        html += `<tr>
            <td width="40%">
                <span style="font-size:11px;color:var(--text-color); opacity: 0.7;">TP ${r} x Risk</span><br>
                <span class="muted-blue" style="font-weight:bold; font-size:15px;">+${tpp}%</span>
            </td>
            <td>
                <div style="display: flex; align-items: baseline; gap: 8px;">
                    <strong style="font-size:15px;">${tp.toLocaleString('id-ID')}</strong>
                    <span style="font-size:11px; color:var(--text-color); opacity: 0.6; white-space: nowrap;">(Est. Rp ${prof.toLocaleString('id-ID')})</span>
                </div>
            </td>
        </tr>`;
    }
    document.getElementById('tpBody').innerHTML = html;
    document.getElementById('results').style.display = 'block';
}

document.addEventListener('DOMContentLoaded', loadSettings);
</script>
</body>
</html>

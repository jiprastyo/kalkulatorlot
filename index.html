<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Lot</title>
    <style>
        :root {
            --bg-color: #000000;
            --container-bg: #121212;
            --table-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #333;
            --accent-blue: #2196f3;
            --accent-header: #1a237e;
            --muted-red: #e57373;
            --muted-blue: #90caf9;
            --input-bg: #2d2d2d;
            --radius: 12px;
        }

        [data-theme="day"] {
            --bg-color: #f5f5f5;
            --container-bg: #ffffff;
            --table-bg: #f9f9f9;
            --text-color: #333333;
            --border-color: #ddd;
            --accent-blue: #1976d2;
            --accent-header: #e3f2fd;
            --muted-red: #d32f2f;
            --muted-blue: #1565c0;
            --input-bg: #ffffff;
        }

        * { font-size: 14px; font-family: sans-serif; box-sizing: border-box; transition: background 0.2s, color 0.2s; }
        body { background-color: var(--bg-color); color: var(--text-color); padding: 15px; line-height: 1.2; margin: 0; }
        
        /* Layout Utama - Responsive */
        .main-wrapper { 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 15px; 
            max-width: 1000px; 
            margin: auto; 
        }

        @media (min-width: 768px) {
            .main-wrapper { grid-template-columns: 400px 1fr; align-items: start; }
        }

        .container { background: var(--container-bg); padding: 15px; border-radius: var(--radius); box-shadow: 0 4px 15px rgba(0,0,0,0.2); height: fit-content; }
        
        .top-nav { display: flex; justify-content: flex-end; margin-bottom: 10px; }
        .icon-btn { cursor: pointer; background: none; border: none; padding: 5px; fill: var(--text-color); display: flex; align-items: center; justify-content: center; }

        table { width: 100%; border-collapse: separate; border-spacing: 0; margin-bottom: 10px; background: var(--table-bg); border-radius: var(--radius); overflow: hidden; border: 1px solid var(--border-color); }
        th { background: var(--accent-header); color: var(--muted-blue); padding: 8px 12px; text-align: left; }
        td { padding: 6px 10px; border-bottom: 1px solid var(--border-color); }
        
        input { width: 100%; padding: 8px; background: var(--input-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 8px; }
        
        .muted-blue { color: var(--muted-blue); }
        .muted-red { color: var(--muted-red); }
        
        button.primary-btn { width: 100%; padding: 12px; background: var(--accent-blue); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        
        .result-box { background: var(--table-bg); padding: 12px; border-top: 3px solid var(--accent-blue); border-radius: var(--radius); }
        .tp-table td { border: 1px solid var(--border-color); padding: 6px 10px; }
        .warning-text { font-size: 11px; color: #ffa726; font-style: italic; display: block; margin-top: 5px; }

        .flex-row { display: flex; align-items: baseline; gap: 5px; flex-wrap: wrap; }
    </style>
</head>
<body>

<div class="main-wrapper">
    <div class="container">
        <div class="top-nav">
            <button class="icon-btn" onclick="toggleTheme()" title="Ganti Tema">
                <svg id="themeIcon" width="20" height="20" viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1z"/></svg>
            </button>
        </div>

        <table>
            <thead><tr><th colspan="2">MODAL & RISIKO</th></tr></thead>
            <tbody>
                <tr><td width="50%">Modal</td><td><input type="text" id="modalDisplay" oninput="formatModal(this); saveSettings();"></td></tr>
                <tr><td>Risiko (%)</td><td><input type="number" id="riskPct" step="0.1" oninput="updateRiskStep(this); saveSettings();"></td></tr>
                <tr><td>Est. Risiko</td><td id="nominalRiskDisplay" class="muted-red" style="font-weight: bold;">Rp 0</td></tr>
            </tbody>
        </table>

        <table>
            <thead><tr><th colspan="2">RENCANA ENTRI</th></tr></thead>
            <tbody>
                <tr><td width="50%">Ticker</td><td><input type="text" id="ticker" placeholder="ACES" oninput="checkTicker()"></td></tr>
                <tr><td>Entry</td><td><input type="number" id="entry" value="0" oninput="updatePriceStep(this)"></td></tr>
                <tr><td>Stop Loss</td><td><input type="number" id="sl" value="0" oninput="updatePriceStep(this)"></td></tr>
            </tbody>
        </table>
        <button class="primary-btn" onclick="calculate()">HITUNG</button>
    </div>

    <div id="results" class="result-box" style="display:none;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <div style="font-weight: bold; font-size: 15px;">HASIL PENGHITUNGAN</div>
            <button class="icon-btn" onclick="copyPlan()" title="Salin Rencana">
                <svg width="20" height="20" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            </button>
        </div>
        
        <table>
            <tbody>
                <tr><td width="40%">Ticker</td><td><span id="resTicker" style="font-weight:bold; text-transform:uppercase;">-</span> <span id="resSharia"></span></td></tr>
                <tr><td>Harga Entry</td><td id="infoEntry" style="font-weight:bold;"></td></tr>
                <tr><td>Lot Beli</td><td><strong id="resLot" class="muted-blue" style="font-size:16px;">0</strong> Lot</td></tr>
                <tr><td>Stop Loss</td><td><span id="infoSL"></span> (<span id="infoRiskPct" class="muted-red"></span>)</td></tr>
                <tr><td>Nilai Transaksi</td><td id="resValue"></td></tr>
                <tr><td>Risiko (1R)</td><td id="resRisk" class="muted-red"></td></tr>
            </tbody>
        </table>
        <span class="warning-text">*Estimasi belum termasuk fee sekuritas.</span>

        <div style="font-weight: bold; margin: 12px 0 5px 0;">TARGET REWARD</div>
        <table class="tp-table"><tbody id="tpBody"></tbody></table>
    </div>
</div>

<script>
// --- LOGIKA TEMA & SETTINGS ---
function setTheme(t) {
    document.documentElement.setAttribute('data-theme', t);
    localStorage.setItem('userTheme', t);
}
function toggleTheme() { setTheme(document.documentElement.getAttribute('data-theme') === 'day' ? 'amoled' : 'day'); }
function formatModal(i) { let v = i.value.replace(/\D/g, ""); i.value = v.replace(/\B(?=(\d{3})+(?!\d))/g, "."); }
function updateRiskStep(i) { i.step = (parseFloat(i.value) < 1) ? 0.1 : 0.5; }
function getIHSGStep(p) { if (p < 200) return 1; if (p < 500) return 2; if (p < 2000) return 5; if (p < 5000) return 10; return 25; }
function updatePriceStep(i) { i.step = getIHSGStep(parseFloat(i.value)); }

function updateNominalRisk() {
    const m = parseFloat(document.getElementById('modalDisplay').value.replace(/\./g, "")) || 0;
    const r = parseFloat(document.getElementById('riskPct').value) || 0;
    document.getElementById('nominalRiskDisplay').innerText = "Rp " + Math.floor(m * (r / 100)).toLocaleString('id-ID');
}

function saveSettings() {
    localStorage.setItem('userModal', document.getElementById('modalDisplay').value);
    localStorage.setItem('userRisk', document.getElementById('riskPct').value);
    updateNominalRisk();
}

function loadSettings() {
    document.getElementById('modalDisplay').value = localStorage.getItem('userModal') || "50.000.000";
    document.getElementById('riskPct').value = localStorage.getItem('userRisk') || "0.50";
    setTheme(localStorage.getItem('userTheme') || 'amoled');
    updateNominalRisk();
}

// --- CORE LOGIC ---
const shariaStocks = ["AADI", "AALI", "ABMM", "ACES", "ACST", "ADCP", "ADES", "ADHI", "ADMG", "ADMR", "ADRO", "AGAR", "AGII", "AIMS", "AISA", "AKKU", "AKPI", "AKRA", "AKSI", "ALDO", "ALKA", "AMAN", "AMFG", "AMIN", "ANDI", "ANJT", "ANTM", "APII", "APLI", "APLN", "ARCI", "AREA", "ARGO", "ARII", "ARNA", "ARTA", "ASGR", "ASHA", "ASII", "ASLC", "ASLI", "ASPI", "ASRI", "ASSA", "ATAP", "ATIC", "ATLA", "AUTO", "AVIA", "AWAN", "AXIO", "AYAM", "AYLS", "BABY", "BAIK", "BANK", "BAPI", "BATA", "BATR", "BAUT", "BAYU", "BBRM", "BBSS", "BCIP", "BDKR", "BEEF", "BELI", "BELL", "BESS", "BEST", "BIKE", "BINO", "BIPP", "BIRD", "BISI", "BKDP", "BKSL", "BLES", "BLOG", "BLTA", "BLTZ", "BLUE", "BMHS", "BMSR", "BMTR", "BNBR", "BOAT", "BOBA", "BOGA", "BOLA", "BOLT", "BRAM", "BRIS", "BRMS", "BRNA", "BRPT", "BRRC", "BSBK", "BSDE", "BSML", "BSSR", "BTPS", "BUAH", "BUKK", "BULL", "BUMI", "BUVA", "BYAN", "CAKK", "CAMP", "CANI", "CARE", "CASS", "CBDK", "CBPE", "CBRE", "CCSI", "CEKA", "CGAS", "CHEK", "CHEM", "CINT", "CITA", "CITY", "CLEO", "CLPI", "CMNP", "CMPP", "CMRY", "CNKO", "CNMA", "COAL", "CPIN", "CPRO", "CRAB", "CRSN", "CSAP", "CSIS", "CSMI", "CSRA", "CTBN", "CTRA", "CYBR", "DAAZ", "DADA", "DATA", "DAYA", "DCII", "DEFI", "DEPO", "DEWA", "DEWI", "DGIK", "DGNS", "DGWG", "DILD", "DIVA", "DKFT", "DKHH", "DMAS", "DMMX", "DMND", "DOOH", "DOSS", "DRMA", "DSFI", "DSNG", "DSSA", "DUTI", "DVLA", "DWGL", "DYAN", "EAST", "ECII", "EDGE", "EKAD", "ELIT", "ELPI", "ELSA", "ELTY", "EMDE", "ENAK", "ENRG", "EPAC", "EPMT", "ERAA", "ERAL", "ESIP", "ESSA", "ESTA", "EXCL", "FAST", "FASW", "FILM", "FIRE", "FISH", "FITT", "FMII", "FOLK", "FOOD", "FORE", "FPNI", "FUTR", "FWCT", "GDST", "GDYR", "GEMA", "GEMS", "GGRP", "GHON", "GIAA", "GJTL", "GLVA", "GMTD", "GOLD", "GOLF", "GOOD", "GPRA", "GPSO", "GRIA", "GRPH", "GTBO", "GTRA", "GTSI", "GULA", "GUNA", "GWSA", "GZCO", "HADE", "HAIS", "HALO", "HATM", "HDIT", "HEAL", "HERO", "HEXA", "HGII", "HITS", "HOKI", "HOMI", "HOPE", "HRME", "HRUM", "HUMI", "HYGN", "IATA", "IBST", "ICBP", "ICON", "IDPR", "IFII", "IFSH", "IGAR", "IIKP", "IKAI", "IKAN", "IKBI", "IKPM", "IMPC", "INCI", "INCO", "INDF", "INDR", "INDS", "INDX", "INDY", "INET", "INKP", "INPP", "INTD", "INTP", "IOTF", "IPCC", "IPCM", "IPOL", "IPTV", "IRRA", "IRSX", "ISAT", "ISSP", "ITMA", "ITMG", "JAST", "JATI", "JAWA", "JAYA", "JECC", "JGLE", "JIHD", "JKON", "JMAS", "JPFA", "JRPT", "JSMR", "JSPT", "JTPE", "KAQI", "KARW", "KBAG", "KBLI", "KBLM", "KDSI", "KDTN", "KEEN", "KEJU", "KETR", "KIAS", "KICI", "KIJA", "KINO", "KIOS", "KJEN", "KKES", "KKGI", "KLAS", "KLBF", "KMDS", "KOBX", "KOCI", "KOIN", "KOKA", "KONI", "KOPI", "KOTA", "KPIG", "KREN", "KRYA", "KSIX", "KUAS", "LABA", "LABS", "LAJU", "LAND", "LCKM", "LION", "LIVE", "LMPI", "LMSH", "LPCK", "LPIN", "LPKR", "LPLI", "LPPF", "LRNA", "LSIP", "LTLS", "LUCK", "MAHA", "MAIN", "MAPA", "MAPB", "MAPI", "MARK", "MAXI", "MBAP", "MBMA", "MBTO", "MCAS", "MCOL", "MDIY", "MDKA", "MDKI", "MDLA", "MEDC", "MEDS", "MERI", "MERK", "META", "MFMI", "MGNA", "MHKI", "MICE", "MIDI", "MIKA", "MINA", "MINE", "MIRA", "MITI", "MKAP", "MKPI", "MKTR", "MLIA", "MLPL", "MLPT", "MMIX", "MMLP", "MNCN", "Mora", "MPIX", "MPMX", "MPOW", "MPPA", "MPRO", "MRAT", "MSIN", "MSJA", "MSKY", "MSTI", "MTDL", "MTEL", "MTFN", "MTLA", "MTMH", "MTPS", "MTSM", "MUTU", "MYOH", "MYOR", "NAIK", "NASA", "NASI", "NCKL", "NELY", "NEST", "NETV", "NFCX", "NICE", "NICL", "NIKL", "NPGF", "NRCA", "NTBK", "NZIA", "OASA", "OBAT", "OBMD", "OILS", "OKAS", "OMED", "OMRE", "PADA", "PALM", "PAMG", "PANI", "PANR", "PART", "PBID", "PBSA", "PCAR", "PDES", "PDPP", "PEHA", "PEVE", "PGAS", "PGEO", "PGLI", "PGUN", "PICO", "PIPA", "PJAA", "PJHB", "PKPK", "PLIN", "PMJS", "PMUI", "PNBS", "PNGO", "PNSE", "POLI", "POLU", "PORT", "POWR", "PPRE", "PPRI", "PPRO", "PRAY", "PRDA", "PRIM", "PSAB", "PSAT", "PSDN", "PSGO", "PSKT", "PSSI", "PTBA", "PTIS", "PTMP", "PTMR", "PTPP", "PTPS", "PTPW", "PTSN", "PTSP", "PURA", "PURI", "PWON", "PZZA", "RAAM", "RAFI", "RAJA", "RALS", "RANC", "RATU", "RBMS", "RDTX", "RGAS", "RIGS", "RISE", "RMKE", "RMKO", "ROCK", "RODA", "RONY", "ROTI", "RSGK", "RUIS", "SAFE", "SAGE", "SAME", "SAMF", "SAPX", "SATU", "SBMA", "SCCO", "SCNP", "SCPI", "SEMA", "SGER", "SGRO", "SHID", "SHIP", "SICO", "SIDO", "SILO", "SIMP", "SIPD", "SKBM", "SKLT", "SKRN", "SLIS", "SMAR", "SMBR", "SMCB", "SMDM", "SMDR", "SMGA", "SMGR", "SMIL", "SMKL", "SMLE", "SMMT", "SMRA", "SMSM", "SNLK", "SOCI", "SOHO", "SOLA", "SONA", "SOSS", "SOTS", "SPMA", "SPTO", "SRTG", "SSIA", "SSTM", "STAA", "STTP", "SULI", "SUNI", "SUPR", "SURI", "SWID", "TALF", "TAMA", "TAMU", "TAPG", "TARA", "TAXI", "TBMS", "TCID", "TCPI", "TEBE", "TFAS", "TFCO", "TGKA", "TGUK", "TINS", "TIRA", "TIRT", "TKIM", "TLDN", "TLKM", "TMAS", "TMPO", "TNCA", "TOBA", "TOOL", "TOSK", "TOTL", "TOTO", "TPIA", "TPMA", "TRIS", "TRJA", "TRON", "TRST", "TRUE", "TRUK", "TSPC", "TYRE", "UANG", "UCID", "UFOE", "ULTJ", "UNIC", "UNIQ", "UNTR", "UNVR", "UVCR", "VAST", "VERN", "VICI", "VISI", "VKTR", "VOKS", "WAPO", "WEGE", "WEHA", "WINR", "WINS", "WIRG", "WMUU", "WOOD", "WOWS", "WTON", "YELO", "YPAS", "YUPI", "ZATA", "ZONE", "ZYRX"];

function checkTicker() {
    const t = document.getElementById('ticker').value.toUpperCase();
    const s = document.getElementById('resSharia');
    document.getElementById('resTicker').innerText = t || "-";
    if (!t) { s.innerText = ""; return; }
    if (shariaStocks.includes(t)) { s.innerText = " (✓ Syariah/ISSI)"; s.className = "muted-blue"; }
    else { s.innerText = " (✗ Non-ISSI)"; s.className = "status-tag muted-red"; }
}

function calculate() {
    const m = parseFloat(document.getElementById('modalDisplay').value.replace(/\./g, ""));
    const rp = parseFloat(document.getElementById('riskPct').value) / 100;
    const e = parseFloat(document.getElementById('entry').value);
    const sl = parseFloat(document.getElementById('sl').value);
    if (!m || e <= 0 || sl <= 0) { alert("Data belum lengkap"); return; }
    const rps = e - sl;
    if (rps <= 0) { alert("SL < Entry"); return; }
    const lot = Math.floor((m * rp / rps) / 100);
    const val = lot * 100 * e;
    document.getElementById('infoEntry').innerText = e.toLocaleString('id-ID');
    document.getElementById('infoSL').innerText = sl.toLocaleString('id-ID');
    document.getElementById('infoRiskPct').innerText = ((rps/e)*100).toFixed(2) + "%";
    document.getElementById('resLot').innerText = lot.toLocaleString('id-ID');
    document.getElementById('resValue').innerText = "Rp " + val.toLocaleString('id-ID');
    document.getElementById('resRisk').innerText = "Rp " + (lot * 100 * rps).toLocaleString('id-ID');
    let html = "";
    for(let r=1; r<=6; r++) {
        const tp = e + (rps * r);
        const tpp = (((tp-e)/e)*100).toFixed(2);
        const prof = lot * 100 * (rps * r);
        html += `<tr><td width="35%"><strong>TP ${r} x Risk</strong></td><td><div class="flex-row"><strong style="font-size:15px;">${tp.toLocaleString('id-ID')}</strong><span style="font-size:11px;opacity:0.6;">(Est. Rp ${prof.toLocaleString('id-ID')} / +${tpp}%)</span></div></td></tr>`;
    }
    document.getElementById('tpBody').innerHTML = html;
    document.getElementById('results').style.display = 'block';
}

function copyPlan() {
    const t = document.getElementById('resTicker').innerText, s = document.getElementById('resSharia').innerText;
    const e = document.getElementById('infoEntry').innerText, l = document.getElementById('resLot').innerText;
    const sl = document.getElementById('infoSL').innerText, sp = document.getElementById('infoRiskPct').innerText;
    const v = document.getElementById('resValue').innerText, r = document.getElementById('resRisk').innerText;
    let txt = `TRADING PLAN ${t} ${s}\nEntry: ${e}\nLot: ${l} Lot\nValue: ${v}\nSL: ${sl} (${sp})\nRisk: ${r}\n\nTarget Reward:\n`;
    document.querySelectorAll('#tpBody tr').forEach((row, i) => {
        const pr = row.cells[1].querySelector('strong').innerText;
        const info = row.cells[1].querySelector('span').innerText;
        txt += `- TP${i+1}: ${pr} ${info}\n`;
    });
    navigator.clipboard.writeText(txt).then(() => alert("Disalin!"));
}

document.addEventListener('DOMContentLoaded', loadSettings);
</script>
</body>
</html>
